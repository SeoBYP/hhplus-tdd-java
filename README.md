## π“ TDD ν•™μµ

### π’΅ κ°μ” (Overview)

λ³Έ ν”„λ΅μ νΈλ” TDD(Test-Driven Development) λ°©λ²•λ΅ μ„ μ μ©ν•μ—¬ μ‚¬μ©μ ν¬μΈνΈ μ‹μ¤ν…μ ν•µμ‹¬ κΈ°λ¥(μ΅°ν, μ¶©μ „, μ‚¬μ©)μ„ κµ¬ν„ν•κ³ , νΉν **λ™μ‹μ„±(Concurrency) λ¬Έμ **λ¥Ό μ•μ „ν•κ² ν•΄κ²°ν•λ” κ²ƒμ„ λ©ν‘λ΅ ν–μµλ‹λ‹¤.

#### ν•µμ‹¬ λ©ν‘ λ° ν•΄κ²° μ „λµ

1.  **λ°μ΄ν„° μ •ν•©μ„± ν™•λ³΄:** λ‹¤μμ μ”μ²­μ΄ λ™μ‹μ— λ“¤μ–΄μ™”μ„ λ• μ”μ•΅ κ³„μ‚° μ¤λ¥(Race Condition)λ¥Ό λ°©μ§€ν–μµλ‹λ‹¤.
    * **ν•΄κ²°:** `PointService`μ— **`ConcurrentHashMap`κ³Ό `ReentrantLock`**μ„ μ‚¬μ©ν•μ—¬ **μ‚¬μ©μ IDλ³„ λ©”λ¨λ¦¬ λ½**μ„ κµ¬ν„ν–μµλ‹λ‹¤. λ™μΌ μ‚¬μ©μ μ”μ²­λ§ μ§λ ¬ν™” μ²λ¦¬ν•κ³  λ‹¤λ¥Έ μ‚¬μ©μ μ”μ²­μ€ λ³‘λ ¬ μ²λ¦¬ν•μ—¬ μ„±λ¥κ³Ό λ¬΄κ²°μ„±μ„ λ™μ‹μ— ν™•λ³΄ν–μµλ‹λ‹¤.
2.  **ν…μ¤νΈ μ©μ΄μ„± ν™•λ³΄ (μ‹κ°„ μμ΅΄μ„± μ κ±°):** `PointHistory` κΈ°λ΅ μ‹ μ‹μ¤ν… μ‹κ°„μ— μμ΅΄ν•λ” λ¬Έμ λ¥Ό ν•΄κ²°ν–μµλ‹λ‹¤.
    * **ν•΄κ²°:** `TimeProvider` μΈν„°νμ΄μ¤μ™€ **`FakeTimeProvider`**λ¥Ό λ„μ…ν•μ—¬ ν…μ¤νΈ μ½”λ“μ—μ„ μ‹κ°„μ„ μμ λ΅­κ² μ΅°μ‘ν•λ©° νμ¤ν† λ¦¬ μ •λ ¬ λ“± μ‹κ°„ κ΄€λ ¨ λ΅μ§μ„ μ™„λ²½ν•κ² κ²€μ¦ν–μµλ‹λ‹¤.
3.  **TDD ν”„λ΅μ„Έμ¤ μ μ©:** λ¨λ“  λ΅μ§μ€ **Red (μ‹¤ν¨) β†’ Green (μ„±κ³µ) β†’ Refactor (κ°μ„ )** μ‚¬μ΄ν΄μ— λ§μ¶° κµ¬ν„λμ—μµλ‹λ‹¤.

---

### π’» μ‘μ—… λ°©μ‹: TDD ν”„λ΅μ„Έμ¤μ— λ”°λ¥Έ κµ¬ν„ μ „λµ

λ¨λ“  κΈ°λ¥μ€ ν…μ¤νΈ μ½”λ“λ¥Ό λ¨Όμ € μ‘μ„±ν•κ³ (Red), μ΄λ¥Ό ν†µκ³Όμ‹ν‚¤λ” μµμ†ν•μ ν”„λ΅λ•μ… μ½”λ“(Green)λ¥Ό μ‘μ„±ν•λ” TDD μ›μΉ™μ„ λ”°λμµλ‹λ‹¤. νΉν, λ³µμ΅λ„κ°€ λ†’μ€ λ™μ‹μ„± λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ λ‹¨κ³„λ³„ μ „λµμ„ μ‚¬μ©ν–μµλ‹λ‹¤.

#### 1. κΈ°λ¥ μ°μ„  TDD (κΈ°λ³Έ κµ¬μ΅° λ° λΉ„μ¦λ‹μ¤ λ΅μ§)
* **μ‘μ—… μλ„:** κ°€μ¥ κΈ°λ³Έμ μ΄κ³  ν•µμ‹¬μ μΈ **λ„λ©”μΈ μ”κµ¬μ‚¬ν•­(μ΅°ν, μ¶©μ „, μ”κ³  λ¶€μ΅±/μμ μ²΄ν¬)**μ„ λ¨Όμ € μ •μν•κ³  κµ¬ν„ν•μ—¬ μ„λΉ„μ¤μ λΌλ€λ¥Ό μ™„μ„±ν–μµλ‹λ‹¤. TDDλ¥Ό ν†µν•΄ `PointService`κ°€ μ–΄λ–¤ κΈ°λ¥μ„ μ κ³µν•΄μ•Ό ν•λ”μ§€ λ…ν™•ν•κ² μ •μν•λ” λ° μ§‘μ¤‘ν–μµλ‹λ‹¤.
* **κµ¬ν„ λ‹¨κ³„:** μ΄κΈ° ν™κ²½ μ„¤μ • ν›„ `μ‹ κ· μ μ € μ΅°ν μ‹ 0ν¬μΈνΈ λ°ν™ ν…μ¤νΈ μ½”λ“ μ‘μ„±`μ„ μ‹μ‘μΌλ΅, `ν¬μΈνΈ μ°¨κ°/μ¶©μ „ Service Layer κµ¬ν„`, `μ”κ³  λ¶€μ΅± μμ™Έ`, `μμ μ¶©μ „/μ‚¬μ© λ¶κ°€` λ“±μ λ‹¨μ„ ν…μ¤νΈλ¥Ό μμ°¨μ μΌλ΅ ν†µκ³Όμ‹ν‚¤λ©° κµ¬ν„ν–μµλ‹λ‹¤.

#### 2. ν…μ¤νΈ κ°€λ¥ν• μ„¤κ³„ μ μ© (μ‹κ°„ μμ΅΄μ„± λ¶„λ¦¬)
* **μ‘μ—… μλ„:** νμ¤ν† λ¦¬ μ΅°ν μ‹ μµμ‹ μ μ •λ ¬μ΄ μ”κµ¬λμ—κΈ° λ•λ¬Έμ—, μ‹κ°„ μ •λ³΄κ°€ μ™Έλ¶€ μ‹μ¤ν…(`System.currentTimeMillis()`)μ— μμ΅΄ν•λ” κ²ƒμ„ λ°©μ§€ν•μ—¬ ν…μ¤νΈμ **λΉ„κ²°μ •μ„±(Non-determinism)**μ„ μ κ±°ν–μµλ‹λ‹¤.
* **κµ¬ν„ λ‹¨κ³„:** `TimeProvider` μΈν„°νμ΄μ¤λ¥Ό μ„¤κ³„ν•κ³  `FakeTimeProvider`λ¥Ό λ§λ“¤μ–΄ DI(Dependency Injection)λ¥Ό ν†µν•΄ μ£Όμ…λ°›λ„λ΅ κµ¬μ΅°λ¥Ό λ³€κ²½ν–μµλ‹λ‹¤. μ΄λ” `2ν μ΄μƒ μ¶©μ „ μ‹ μµμ‹ μμΌλ΅ μ •λ ¬λ κ°’μ„ λ°ν™ν•λ” ν…μ¤νΈ μ½”λ“ μ‘μ„±`μ„ μ„±κ³µμ‹ν‚¤λ” ν•µμ‹¬ κΈ°λ°μ΄ λμ—μµλ‹λ‹¤.

#### 3. λ™μ‹μ„± ν…μ¤νΈ μ£Όλ„ κ°λ° (Lock λ„μ…)
* **μ‘μ—… μλ„:** κ°€μ¥ μ¤‘μ”ν• μ”κµ¬μ‚¬ν•­μΈ λ™μ‹μ„± λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄, λ¨Όμ € **Lockμ΄ μ—†λ” μƒνƒμ—μ„ μ‹¤ν¨ν•λ” ν…μ¤νΈ**λ¥Ό μ‘μ„±ν•μ—¬ λ¬Έμ  μƒν™©μ„ λ…ν™•ν μ •μν–μµλ‹λ‹¤.
* **κµ¬ν„ λ‹¨κ³„:**
    1.  **Red (λ¬Έμ  μ •μ):** `UserPointTableTest.java`μ— **`CountDownLatch`μ™€ `ExecutorService`**λ¥Ό μ‚¬μ©ν•μ—¬ `λ™μ‹μ„± ν…μ¤νΈ μ½”λ“ μ‹¤ν¨` μΌ€μ΄μ¤λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤. μ΄ ν…μ¤νΈλ” Lockμ΄ μ—†κΈ° λ•λ¬Έμ— λ°μ΄ν„°κ°€ μ μ‹¤λμ–΄ μ”μ•΅μ΄ κΈ°λ€κ°’(μ: 2000)λ³΄λ‹¤ μ κ² λ‚μ¤λ” κ²ƒμ„ ν™•μΈν•λ” μ—­ν• μ„ ν–μµλ‹λ‹¤.
    2.  **Green (μ†”λ£¨μ… μ μ©):** μ‹¤ν¨ν•λ” ν…μ¤νΈλ¥Ό ν†µκ³Όμ‹ν‚¤κΈ° μ„ν•΄ `PointService`μ— **μ‚¬μ©μλ³„ `ReentrantLock`** λ΅μ§μ„ μ¶”κ°€ν–μµλ‹λ‹¤.
    3.  **Refactor & κ²€μ¦:** Lock μ μ© ν›„ `λ™μ‹μ„± ν…μ¤νΈ μ½”λ“ μ„±κ³µ`μ„ ν™•μΈν•κ³ , μ‹¤μ  API ν™κ²½μ—μ„ κ²€μ¦ν•κΈ° μ„ν•΄ `feature/TDD λ™μ‹μ„± ν†µν•© ν…μ¤νΈ μ½”λ“ κµ¬ν„`κΉμ§€ μ§„ν–‰ν•μ—¬ μµμΆ…μ μΌλ΅ μ •ν•©μ„±μ„ ν™•μΈν–μµλ‹λ‹¤.

---

### π± μ•κ² λ μ  (Learned Points)

#### 1. TDD ν”„λ΅μ„Έμ¤μ μ΄ν•΄λ„ μ¦μ§„
* λ‹¨μν ν…μ¤νΈ μ½”λ“λ¥Ό λ¨Όμ € μ‘μ„±ν•λ” κ²ƒμ„ λ„μ–΄, **ν…μ¤νΈ μ½”λ“κ°€ κµ¬ν„ μ½”λ“μ μ„¤κ³„λ¥Ό μ΄λμ–΄λ‚΄κ³ ** μμ΅΄μ„±μ„ λ¶„λ¦¬(TimeProvider)ν•λ” ν•µμ‹¬μ μΈ μ—­ν• μ„ ν•λ‹¤λ” TDD ν”„λ΅μ„Έμ¤μ λ³Έμ§μ μΈ μ΄ν•΄λ„λ¥Ό λ†’μ€μµλ‹λ‹¤.
* **μ…€ν”„ ν”Όλ“λ°±:** μ΄κΈ°μ—λ” TDD λ¶„κΈ° μ‘μ—…μ— λ―Έν΅ν•¨μ΄ μμ—μΌλ‚, **κµ¬ν„λ μ½”λ“λ¥Ό λ°”νƒ•μΌλ΅ TDD μ‚¬μ΄ν΄μ— λ§μ¶° μ»¤λ°‹μ„ μ¬κµ¬μ„±**ν•λ©΄μ„, μ‘μ—… λ‹¨μ„λ³„ ν…μ¤νΈ μ‘μ„±μ μ¤‘μ”μ„±μ„ κΉμ΄ μ²΄κ°ν–μµλ‹λ‹¤.

#### 2. Java Concurrency API λ° ν¨ν„΄μ μ‹¤μ „ μ μ©
* Java ν™κ²½μ—μ„ **`ReentrantLock`μ„ `ConcurrentHashMap`μΌλ΅ κ΄€λ¦¬**ν•λ” μ‚¬μ©μλ³„ λ½ ν¨ν„΄μ„ μ„λΉ„μ¤ λ μ΄μ–΄μ— μ μ©ν•λ” λ°©λ²•μ„ μ™λ‹¬ν–μµλ‹λ‹¤.
* `ExecutorService`, `CountDownLatch` λ“± Concurrency APIλ¥Ό ν™μ©ν•μ—¬ λ©€ν‹°μ¤λ λ“ ν™κ²½μ„ κµ¬μ¶•ν•κ³  ν…μ¤νΈν•λ” μ‹¤μ „ κ²½ν—μ„ μ“μ•μµλ‹λ‹¤.

#### 3. ν…μ¤νΈ ν™κ²½ κµ¬μ¶• λ° μμ΅΄μ„± λ¶„λ¦¬
* μ‹μ¤ν… μ‹κ°„ μμ΅΄μ„±μ„ μ™„λ²½ν•κ² λ¶„λ¦¬ν• `TimeProvider` ν¨ν„΄μ€ ν…μ¤νΈ μ½”λ“μ **κ²°μ •λ΅ μ (Deterministic)** μ‹¤ν–‰μ„ λ³΄μ¥ν•λ” μ°μ μ„¤κ³„ ν¨ν„΄μ„μ„ ν™•μΈν–μµλ‹λ‹¤.
* μΈλ©”λ¨λ¦¬ ν…μ΄λΈ”μ„ μ‚¬μ©ν•λ©΄μ„λ„ λ™μ‹μ„± λ¬Έμ κΉμ§€ μ™„λ²½ν•κ² ν…μ¤νΈν•λ” ν™κ²½μ„ κµ¬μ¶•ν•¨μΌλ΅μ¨, **Mocking μ—†λ” λ‹¨μ„ ν…μ¤νΈ**μ κ°•λ ¥ν•¨μ„ ν™•μΈν–μµλ‹λ‹¤.
